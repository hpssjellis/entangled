<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.13"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Entangled: Tanglescope</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="IOTA_Logo_black.png"/></td>
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">Entangled
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.13 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('md_tanglescope__r_e_a_d_m_e.html','');});
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">Tanglescope </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>Tanglescope is a program composed of metric collectors, Each collector is responsible for a different aspect of the Tangle behavior and collects different set of metrics and exposes them to a configurable prometheus end point. (<a href="https://github.com/prometheus/prometheus">https://github.com/prometheus/prometheus</a>)</p>
<h1>Configuration </h1>
<p>Each collector has its own section defined in a yaml file whose path is specified by <code>--ConfigurationPath</code> flag (Default example yaml file in runner/configuration.yaml)</p>
<h1>Collectors: </h1>
<h2>Stats collector </h2>
<p><b>Purpose:</b></p>
<p>Measuring transactions/bundles traffic data by listening to a list of zmq publisher (IRI nodes with <code>ZMQ_ENABLED = true</code>)</p>
<p><b>Configuration section example:</b></p>
<div class="fragment"><div class="line">statscollector:</div><div class="line"></div><div class="line">#IP / Port that the Prometheus Exposer binds to</div><div class="line">  prometheus_exposer_uri: &quot;0.0.0.0:8081&quot;</div><div class="line">#URL of ZMQ publisher to connect to</div><div class="line">  publishers:</div><div class="line">      - &quot;tcp://zmq.testnet.iota.org:5556&quot;</div><div class="line"></div><div class="line">#histogram of bundle&#39;s confirmation duration granularity:</div><div class="line">#(number of buckets = bundle_confirmation_histogram_range * 1000 / bundle_confirmation_bucket_size)</div><div class="line"></div><div class="line">#histogram&#39;s range  [seconds]</div><div class="line">  bundle_confirmation_histogram_range: 240</div><div class="line">#bucket&#39;s size [seconds]</div><div class="line">  bundle_confirmation_bucket_size: 2</div></div><!-- fragment --><p><b>Metrics</b>:</p>
<ul>
<li>statscollector_bundles_confirmed (confirmed bundles count) [Counter]</li>
<li>statscollector_value_transactions_new (Value TXs count) [Counter]</li>
<li>statscollector_bundles_new (new bundles count) [Counter]</li>
<li>statscollector_transactions_confirmed (confirmed TXs count) [Counter]</li>
<li>statscollector_value_transactions_confirmed (Confirmed value TX's count) [Counter]</li>
<li>statscollector_transactions_new (new TXs count) [Counter]</li>
<li>statscollector_transactions_reattached (Reattached TXs count) [Counter]</li>
<li>statscollector_value_confirmed (Confirmed tx's accumulated value) [Counter]</li>
<li>statscollector_value_new (new tx's accumulated value) [Counter]</li>
<li>statscollector_bundle_confirmation_duration (bundle's confirmation duration [seconds]) [Histogram]</li>
<li>statscollector_to_broadcast (Number of transactions to broadcast to other nodes) [Gauge]</li>
<li>statscollector_to_process (Number of transactions to process) [Gauge]</li>
<li>statscollector_to_reply (Number of transactions to reply to nodes who requested) [Gauge]</li>
<li>statscollector_to_request (Number of transactions to request from other nodes) [Gauge]</li>
<li>statscollector_total_transactions (Number of transactions stored in node) [Counter]</li>
<li>statscollector_milestones_count (Number of received milestones) [Counter]</li>
</ul>
<h2>Echo collector </h2>
<p><b>Purpose:</b></p>
<p>Measuring the quality of the network by issuing transactions and tracking their propagation through other nodes which has <code>ZMQ_ENABLED = true</code> (list of <code>publishers</code> in configuration section)</p>
<p>Measurement data can be used for network topology improvement by proposing the owner of the "farthest" node to become a neighbor and warning the owner of the "closest" node that his node will be removed from the neighbors list. Note, Brief description of the logic:</p><ul>
<li>Alice generates a special transaction containing <code>udp://IP:portUsedSolelyForEchoCatcher</code> and tag "ECHOCATCHER" and attaches it to the tangle with a pretty high minWeightMagnitude</li>
<li>the others send a special UDP packet to <code>udp://IP:portUsedSolelyForEchoCatcher</code> right after they receive Alice's transaction, the packet must contain the contact info of the node operator</li>
<li>Alice measures interval between broadcasting a transaction and receiving its "echo"</li>
<li>the measurement is repeated several times with other transactions to collect average echo intervals</li>
</ul>
<p><b>Configuration section example:</b></p>
<div class="fragment"><div class="line">  echocollector:</div><div class="line">#list of publishers to listen to.(they should return the echo)</div><div class="line">  publishers:</div><div class="line">      - &quot;tcp://zmq.testnet.iota.org:5556&quot;</div><div class="line"></div><div class="line">#url of iri node</div><div class="line">  iri_host: &quot;iri01.testnet.iota.cafe&quot;</div><div class="line">  iri_port: 14265</div><div class="line">#IP / Port that the Prometheus Exposer binds to</div><div class="line">  prometheus_exposer_uri: &quot;0.0.0.0:8080&quot;</div><div class="line">#MWM for transaction&#39;s POW</div><div class="line">  mwm: 9</div><div class="line">#in - between transactions interval[seconds]</div><div class="line">  broadcast_interval: 20</div><div class="line">#how often should echocatcher discover &quot;unseen&quot; transactions[seconds]</div><div class="line">#shouldn&#39;t be too frequent since it can incur in multiple api</div><div class="line">#calls..</div><div class="line">  discovery_interval: 5  </div></div><!-- fragment --><p>Also requires:</p>
<div class="fragment"><div class="line">dbloader:</div><div class="line"></div><div class="line">#URL of ZMQ publisher to connect to</div><div class="line">  publisher: &quot;tcp://zmq.testnet.iota.org:5556&quot;</div><div class="line">#TX&#39;s older than that age will be removed each cleanup_interval [seconds]</div><div class="line">  oldest_tx_age: 1800</div><div class="line">#in - between cleanup interval[seconds]</div><div class="line">  cleanup_interval: 60</div></div><!-- fragment --><p><b>Metrics</b>:</p>
<ul>
<li>echocollector_time_elapsed_arrived (Milliseconds it took for tx to arrive to destination) [Histogram]</li>
<li>echocollector_time_elapsed_received (Milliseconds it took for tx to travel back to transaction's original source) [Histogram]</li>
<li>echocollector_time_elapsed_unseen_tx_published (Milliseconds it took for tx to be published since the moment client first learned about it) [Histogram]</li>
</ul>
<h2>Blowball collector </h2>
<p><b>Purpose:</b></p>
<p>Identifying blowballs which can indicate network problems/malice behavior. By listening to a list of zmq publishers (IRI nodes with <code>ZMQ_ENABLED = true</code>) and ref counting transaction's direct approvers</p>
<p><b>Configuration section example:</b> </p><div class="fragment"><div class="line">blowballcollector:</div><div class="line"></div><div class="line">#IP / Port that the Prometheus Exposer binds to</div><div class="line">  prometheus_exposer_uri: &quot;0.0.0.0:8082&quot;</div><div class="line">#URL of ZMQ publisher to connect to</div><div class="line">  publisher: &quot;tcp://zmq.testnet.iota.org:5556&quot;</div><div class="line">#interval between following snapshots(internal counters update)</div><div class="line">  snapshot_interval: 60</div><div class="line"></div><div class="line">#histogram granularity configuration</div><div class="line">#histogram &#39;s bucket&#39; s size(refcount of tx approvers)</div><div class="line">  bucket_size: 1</div><div class="line">#histogram&#39;s range (maximum value of refcount to report)</div><div class="line">  histogram_range: 40up_interval: 60</div></div><!-- fragment --><p><b>Metrics</b>:</p>
<ul>
<li>blowball_tx_num_approvers (Number of transactions directly approving a single transaction) [Histogram]</li>
</ul>
<h2>Tip selection collector </h2>
<p><b>Purpose:</b></p>
<p>Monitoring tip selection's algorithm behavior.</p>
<p><b>Configuration section example:</b> </p><div class="fragment"><div class="line">tipselectioncollector:</div><div class="line"></div><div class="line">#IP / Port that the Prometheus Exposer binds to</div><div class="line">  prometheus_exposer_uri: &quot;0.0.0.0:8083&quot;</div><div class="line">#url of iri node</div><div class="line">  iri_host : &quot;iri01.testnet.iota.cafe&quot;</div><div class="line">  iri_port: 14265</div><div class="line">#depth to give to &quot;getTransactionsToApprove&quot;</div><div class="line">  depth: 10</div><div class="line">#in - between samples interval[seconds]</div><div class="line">  sample_interval: 20</div><div class="line">#of calls to getTransactionsToApprove in each sample</div><div class="line">  sample_size: 20</div><div class="line">#histogram granularity configuration</div><div class="line">#duration &#39;s histogram (time it took &#39; getTransactionsToApprove &#39;) bucket&#39; s size[ms]</div><div class="line">  duration_bucket_size: 20</div><div class="line">#duration &#39;s histogram range (maximum time it took &#39; getTransactionsToApprove&#39;)</div><div class="line">  duration_histogram_range: 1000</div></div><!-- fragment --><p><b>Metrics</b>:</p>
<ul>
<li>tipselection_num_trunk_eq_branch (# of times both selected tips were the same) [Histogram]</li>
<li>tipselection_num_tx_was_not_a_tip (# of times selected tx was not a tip) [Histogram]</li>
<li>tipselection_num_tx_was_selected (# of times tip/tx was selected) [Histogram]</li>
<li>tipselection_tip_selection_duration (The duration_of_tip_selection) [Histogram]</li>
</ul>
<h2>Tangle's width collector </h2>
<p><b>Purpose:</b></p>
<p>Measuring tangle width as defined below: </p><div class="fragment"><div class="line">Width definition (by Darcy Camargo):</div><div class="line">W(s,t) = |{(Vi,Vj) : Vi approves Vj, Vi &gt; s, Vj &lt; s}|</div><div class="line">&#39;t&#39; is of course &gt; &#39;s&#39; and the more t &gt; s the more</div><div class="line">complete is the picture of the tangle in regards to</div><div class="line">the measure line s</div><div class="line">(basically, number of graph edges crossing a measure line/timepoint)</div></div><!-- fragment --><p><b>Configuration section example:</b></p>
<div class="fragment"><div class="line">tanglewidthcollector:</div><div class="line"></div><div class="line">#IP / Port that the Prometheus Exposer binds to</div><div class="line">  prometheus_exposer_uri: &quot;0.0.0.0:8084&quot;</div><div class="line">#The measure line base from the above definition, [seconds]</div><div class="line">  measure_line_base_age: 30</div><div class="line">#The measure line max age[seconds]</div><div class="line">  measure_line_max_age: 90</div><div class="line">#Step from measure_line_base_age to measure_line_max_age, [seconds]</div><div class="line">  measure_line_age_step: 10</div><div class="line">#interval between following snapshots(internal counters update)</div><div class="line">  snapshot_interval: 10</div></div><!-- fragment --><p>Also requires:</p>
<div class="fragment"><div class="line">dbloader:</div><div class="line"></div><div class="line">#URL of ZMQ publisher to connect to</div><div class="line">  publisher: &quot;tcp://zmq.testnet.iota.org:5556&quot;</div><div class="line">#TX&#39;s older than that age will be removed each cleanup_interval [seconds]</div><div class="line">  oldest_tx_age: 1800</div><div class="line">#in - between cleanup interval[seconds]</div><div class="line">  cleanup_interval: 60</div></div><!-- fragment --><p><b>Metrics</b>:</p>
<ul>
<li>tanglewidthcollector_measure_line (Measure line's timestamp) [Gauge]</li>
<li>tanglewidthcollector_tangle_width (Width/Number of edges crossing a measure line) [Gauge]</li>
</ul>
<h2>Confirmation rate collector </h2>
<p><b>Purpose:</b></p>
<p>Measuring transaction's confirmation rate</p>
<p><b>Configuration section example:</b></p>
<div class="fragment"><div class="line">confirmationratecollector:</div><div class="line">#list of publisher to listen to.(they should return the echo)</div><div class="line">  publishers:</div><div class="line">      - &quot;tcp://zmq.testnet.iota.org:5556&quot;</div><div class="line"></div><div class="line">#url of iri node</div><div class="line">  iri_host: &quot;iri01.testnet.iota.cafe&quot;</div><div class="line">  iri_port: 14265</div><div class="line">#IP / Port that the Prometheus Exposer binds to</div><div class="line">  prometheus_exposer_uri: &quot;0.0.0.0:8085&quot;</div><div class="line">#MWM for transaction&#39;s POW</div><div class="line">  mwm: 9</div><div class="line">#in - between transactions interval[seconds]</div><div class="line">  broadcast_interval: 3</div><div class="line"></div><div class="line">#Time after which we should expect transaction to be approved</div><div class="line">  measurement_upper_bound: 60</div><div class="line">#Time after which if a transaction hasn&#39;t been approved, we give up</div><div class="line">  measurement_lower_bound: 360</div><div class="line">#should calculate confirmation rate using API calls</div><div class="line">  enable_cr_from_api: true</div><div class="line">#For checking the CR for various Latencies, define the latency in seconds,</div><div class="line">#&quot;step&quot; means that for 10 seconds we will check latency of 10, 20, 30 seconds</div><div class="line">  additional_latency_step_seconds: 10</div><div class="line">#num different latencies to check</div><div class="line">  additional_latency_num_steps: 3</div></div><!-- fragment --><p><b>Metrics</b>:</p>
<ul>
<li>confirmationratecollector_confirmation_rate_api (Confirmation rate ratio [0,1] as it is perceived by making api calls to "getInclusionStates") [Gauge]</li>
<li>confirmationratecollector_confirmation_rate_zmq (Confirmation rate ratio [0,1] as it is perceived by inspecting the zmq stream) [Gauge] </li>
</ul>
</div></div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.13 </li>
  </ul>
</div>
</body>
</html>
